<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CENSORED SEME SORT</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        /* 기본 배경 설정 */
        body { font-family: 'Pretendard', sans-serif; text-align: center; background: #050505; color: #fff; margin: 0; padding: 20px; }
        
        /* 레이아웃 폭 조정: 화면의 약 40% 수준 (모바일 고려 최대 480px) */
        #container { max-width: 480px; margin: auto; background: #1F1F1F; padding: 25px; border: 2px solid #DB0000; border-radius: 0; }
        
        h1 { color: #DB0000; margin-bottom: 20px; font-weight: 800; font-size: 24px; border-bottom: 2px solid #DB0000; display: inline-block; padding-bottom: 5px; }
        
        .description, .instruction { color: #fff; line-height: 1.6; margin-bottom: 20px; word-break: keep-all; }
        .instruction { font-size: 18px; font-weight: 700; }

        /* 선택 영역 레이아웃: 세로 배치로 변경하여 좁은 폭 최적화 */
        .match-box { display: flex; flex-direction: column; align-items: center; gap: 15px; margin: 20px 0; }
        .item-card { cursor: pointer; border: 2px solid #DB0000; border-radius: 0; overflow: hidden; transition: 0.2s; background: #000; width: 100%; max-width: 300px; }
        .item-card:hover { background: #1a0000; border-color: #ff4d4d; }
        .item-card img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; display: block; }
        .item-name { padding: 12px; font-size: 16px; font-weight: bold; border-top: 2px solid #DB0000; color: #fff; }

        /* 결과 테이블 디자인 */
        #result { display: none; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; border: 2px solid #DB0000; font-size: 14px; }
        th, td { border: 1px solid #DB0000; padding: 10px; text-align: center; background: #000; }
        th { background: #DB0000; color: #fff; }
        .rank-img { width: 50px; height: 50px; object-fit: cover; border: 1px solid #DB0000; }
        
        /* 1위 강조 (어두운 검정 배경) */
        .rank-highlight { background-color: #111 !important; color: #DB0000 !important; font-weight: 800; }

        /* 버튼 디자인 */
        .btn { width: 100%; max-width: 300px; margin-top: 15px; padding: 12px; background: #000; color: #DB0000; border: 2px solid #DB0000; border-radius: 0; cursor: pointer; font-weight: bold; font-family: 'Pretendard', sans-serif; transition: 0.2s; }
        .btn:hover { background: #DB0000; color: #fff; }
        #progress { margin-bottom: 10px; color: #DB0000; font-size: 13px; font-weight: 800; letter-spacing: 1px; }
    </style>
</head>
<body>

<div id="container">
    <h1>CENSORED SEME SORT</h1>

    <div id="intro">
        <div class="description">
            CENSORED 애프터 커페스 왼른 순위 비교용 소트입니다.<br>
            선택지는 총 28번 제시되며, 소트 종료 후 결과 이미지를 공유해주세요.
        </div>
        <button class="btn" onclick="startGame()">START</button>
    </div>

    <div id="game-area" style="display:none;">
        <div id="progress"></div>
        <div class="instruction">둘 중 더 왼력이 높은 쪽은?</div>
        <div class="match-box">
            <div class="item-card" onclick="vote(0)">
                <img id="img1" src="" alt="">
                <div id="name1" class="item-name"></div>
            </div>
            <div class="item-card" onclick="vote(1)">
                <img id="img2" src="" alt="">
                <div id="name2" class="item-name"></div>
            </div>
        </div>
    </div>

    <div id="result">
        <div id="capture-area" style="background:#1F1F1F; padding:15px;">
            <h3 style="margin-top:0;">최종 순위</h3>
            <table id="rankTable">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>얼굴</th>
                        <th>이름</th>
                        <th>승수</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="btn" onclick="location.reload()">RESTART</button>
        <button class="btn" onclick="saveResult()">결과 이미지 저장</button>
    </div>
</div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
    const items = [
        { name: "에제 애션포드<br>179cm 남성, 마법 인형 조형사", img: "https://media.planet.moe/accounts/avatars/114/404/044/998/722/709/original/29b8842b8f77747f.png" },
        { name: "그레타 에펜<br>158cm 여성, 마법 정부 공무원", img: "https://media.planet.moe/accounts/avatars/114/404/036/067/687/420/original/60fe0b0a4694f250.png" },
        { name: "애쉬튼 페녹<br>179cm 남성, 무직(부자)", img: "https://media.planet.moe/accounts/avatars/114/404/047/900/930/742/original/2912e93b8877eaee.jpeg" },
        { name: "체스터 휴즈<br>179cm 남성, 영화 특수효과 기술자", img: "https://media.planet.moe/accounts/avatars/114/404/072/912/450/296/original/9ebf5e86361601d3.png" },
        { name: "윌로우 머피<br>179cm 논바이너리(여성), 선원", img: "https://media.planet.moe/accounts/avatars/114/404/005/036/002/592/original/65c6690e913b6e7b.png" },
        { name: "사샤 필즈모어<br>163cm 여성, 약제사", img: "https://media.planet.moe/accounts/avatars/114/404/221/344/864/295/original/23a722aeae58b5f0.png" },
        { name: "아스카 라일라이<br>153cm 여성, F1 엔지니어", img: "https://media.planet.moe/accounts/avatars/114/404/001/130/180/308/original/8884986bf08dfdc5.png" },
        { name: "아서 윈슬로<br>185cm 남성, 영화배우", img: "https://media.planet.moe/accounts/avatars/114/404/011/886/960/481/original/f3a57b5e77a288a2.png" }
    ];

    let scores = Array(8).fill(0);
    let matches = [];
    let currentMatchIndex = 0;

    function startGame() {
        document.getElementById('intro').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        matches.sort(() => Math.random() - 0.5);
        updateDisplay();
    }

    for (let i = 0; i < 8; i++) {
        for (let j = i + 1; j < 8; j++) { matches.push([i, j]); }
    }

    function updateDisplay() {
        if (currentMatchIndex < matches.length) {
            const [idx1, idx2] = matches[currentMatchIndex];
            document.getElementById('img1').src = items[idx1].img;
            document.getElementById('name1').innerHTML = items[idx1].name;
            document.getElementById('name2').innerHTML = items[idx2].name;
            document.getElementById('img2').src = items[idx2].img;
            document.getElementById('name1').innerHTML = items[idx1].name;
            document.getElementById('name2').innerHTML = items[idx2].name;
            document.getElementById('progress').innerText = `MATCH: ${currentMatchIndex + 1} / 28`;
        } else { showResult(); }
    }

    function vote(side) {
        const [idx1, idx2] = matches[currentMatchIndex];
        scores[side === 0 ? idx1 : idx2]++;
        currentMatchIndex++;
        updateDisplay();
    }

    function showResult() {
        document.getElementById('game-area').style.display = 'none';
        const tbody = document.querySelector('#rankTable tbody');
        const ranked = items.map((item, i) => ({ ...item, score: scores[i] }))
                           .sort((a, b) => b.score - a.score);

        ranked.forEach((item, index) => {
            const tiedRank = ranked.findLastIndex(r => r.score === item.score) + 1;
            const isTop = tiedRank === (ranked.findLastIndex(r => r.score === ranked[0].score) + 1);

            const row = `<tr class="${isTop ? 'rank-highlight' : ''}">
                <td>${tiedRank}</td>
                <td><img src="${item.img}" class="rank-img"></td>
                <td>${item.name}</td>
                <td>${item.score}</td>
            </tr>`;
            tbody.innerHTML += row;
        });
        document.getElementById('result').style.display = 'block';
    }

    function saveResult() {
        const target = document.getElementById('capture-area');
        html2canvas(target).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Result.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
</html>